<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GHost AI</title>
  
  <link rel="stylesheet" href="/static/style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body>
<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  background:#000;
  font-family:Inter,Arial,sans-serif;
  color:#e6eef8;
  overflow-x:hidden;
}
.popup-backdrop{
  position:fixed;
  inset:0;
  display:none;
  background:transparent;
  z-index:998;
}

/* --------------------- SIDEBAR --------------------- */
.sidebar{
  width:260px;
  height:100vh;
  background:#111;
  position:fixed;
  left:0;top:0;
  padding:15px;
  display:flex;
  flex-direction:column;
  border-right:1px solid #222;
  justify-content:space-between;
  z-index:999;
}

.sidebar-chats{
  flex:1;
  overflow-y:auto;
  margin-top:10px;
}

.chat-item{
  padding:10px;
  background:#1a1a1a;
  border-radius:6px;
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
}
.chat-item:hover{background:#292929;}

/* --------------------- PROFILE --------------------- */
.sidebar-profile{
  display:flex;
  align-items:center;
  gap:10px;
  padding:14px;
  border-top:1px solid #222;
  cursor:pointer;
}
.sidebar-profile:hover{background:#181818;}

.sidebar-chats {
  scroll-behavior: smooth;
}
.profile-img-small{
  width:38px;
  height:38px;
  border-radius:50%;
  border:2px solid #8B5CF6;
}
.profile-name{color:#ccc;font-size:14px;}

/* --------------------- POPUP --------------------- */

.profile-popup{
  position:fixed;
  bottom:80px;
  left:20px;
  width:220px;
  background:#111;
  border:1px solid #222;
  border-radius:12px;
  padding:15px;
  box-shadow:0 8px 25px rgba(0,0,0,0.4);

  opacity:0;
  transform:scale(.85);
  pointer-events:none;
  transition:.2s ease;
  transform-origin:bottom left;
  z-index:1000;
}
.profile-popup.active{
  opacity:1;
  transform:scale(1);
  pointer-events:auto;
}

.popup-header{
  text-align:center;
  padding-bottom:12px;
  border-bottom:1px solid #222;
}
.popup-img{
  width:60px;height:60px;
  border-radius:50%;
  border:2px solid #8B5CF6;
}
.popup-name{font-weight:600;}
.popup-email{font-size:12px;color:#888;}

.popup-btn{
  display:block;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  background:#181818;
  text-align:center;
  text-decoration:none;
  color:#ccc;
}
.popup-btn:hover{background:#242424;}
.popup-btn.logout{background:#8B5CF6;color:#fff;}

/* --------------------- MAIN CHAT --------------------- */
.app{
  margin-left:260px;
  height:100vh;
  display:flex;
  flex-direction:column;
}

.chat-area{
  flex:1;
  display:flex;
  flex-direction:column;
  background:#050505;
  overflow-y: auto;
  min-height: 0;
  margin:18px;
  border-radius:12px;
  border:1px solid #111;
}

/* ===== MESSAGES CONTAINER ===== */
.messages{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  overflow-y:auto;
  padding:20px;
  gap:14px; /* consistent vertical spacing */
  scroll-behavior:smooth;
}
.chat-header{
  padding:14px 18px;
  border-bottom:1px solid #111;
  font-weight:600;
  background:#0a0a0a;
}
/* ===== MESSAGE BUBBLES ===== */
.msg{
  display:inline-block;
  max-width:72%;
  padding:12px 16px;
  border-radius:16px;
  font-size:15px;
  line-height:1.5;
  white-space:pre-wrap;
  word-break:break-word;
  margin:0;
  animation: popIn .18s ease-out;
}
@keyframes popIn {
  from { opacity:0; transform:translateY(4px); }
  to { opacity:1; transform:none; }
}
/* USER RIGHT */
.msg.user{
  align-self:flex-end;
  background:#ffffff;
  color:#000;
  border-radius:16px 16px 4px 16px;
}

/* BOT LEFT */
.msg.bot{
  align-self:flex-start;
  background:#262626;
  color:#fff;
  border:1px solid #333;
  border-radius:16px 16px 16px 4px;
}

.msg + .msg{
  margin-top:0;
}


/* --------------------- INPUT --------------------- */
.composer{
  display:flex;
  gap:10px;
  padding:12px;
  background:#0a0a0a;
  border-top:1px solid #111;
}
.composer input{
  flex:1;
  padding:12px 18px;
  border-radius:25px;
  background:#222;
  border:none;
  color:#eee;
}
.send-btn{
  width:46px;
  border-radius:50%;
  border:none;
  font-size:20px;
  background:linear-gradient(90deg,#4f46e5,#06b6d4);
  cursor:pointer;
}
.send-btn:active{
  transform:scale(0.92);
}
.typing {
  font-size:13px;
  color:#888;
  margin-left:10px;
}

.typing::after {
  content: "‚Ä¶";
  animation: dots 1.2s steps(3, end) infinite;
}

@keyframes dots {
  0% { content:""; }
  33% { content:"."; }
  66% { content:".."; }
  100% { content:"..."; }
}
@media(max-width:900px){
  .sidebar{width:220px;}
  .app{margin-left:220px;}
}
</style>


<!-- =============== SIDEBAR =============== -->
<div class="sidebar">

  <div class="sidebar-chats" id="chatList">
  <div style="color:#555;font-size:13px;padding:10px;">
    No conversations yet
  </div>
</div>

  <div id="profileTrigger" class="sidebar-profile">
    <img src="{{ session.photo }}" class="profile-img-small">
    <span class="profile-name">{{ session.name }}</span>
  </div>
</div>


<!-- =============== PROFILE POPUP =============== -->
<div id="profileBackdrop" class="popup-backdrop"></div>

<div id="profilePopup" class="profile-popup">
  <div class="popup-header">
    <img src="{{ session.photo }}" class="popup-img">
    <div class="popup-name">{{ session.name }}</div>
    <div class="popup-email">{{ session.email }}</div>
  </div>

  <a href="/settings" class="popup-btn">‚öôÔ∏è Settings</a>
  <a href="/logout" class="popup-btn logout">üö™ Logout</a>
</div>


<!-- =============== CHAT PANEL =============== -->
<div class="app">
  <main class="chat-area">
    <header class="chat-header">GHost AI üëª</header>

    <section id="messages" class="messages"></section>

    <form id="inputForm" class="composer">
     <input id="messageInput" name="message" autocomplete="off" placeholder="Type a message..." />
      <button class="send-btn" type="submit" aria-label="Send message">‚û§</button>
    </form>
  </main>
</div>


<!-- FIREBASE -->
<script>
const firebaseConfig = {{ firebase_config_json|safe }};
firebase.initializeApp(firebaseConfig);
</script>

<!-- PROFILE POPUP SCRIPT -->
<script>
const profileTrigger = document.getElementById("profileTrigger");
const profilePopup   = document.getElementById("profilePopup");
const backdrop       = document.getElementById("profileBackdrop");

function togglePopup(){
  if(profilePopup.classList.contains("active")) closePopup();
  else openPopup();
}

function openPopup(){
  profilePopup.classList.add("active");
  backdrop.style.display = "block";
}

function closePopup(){
  profilePopup.classList.remove("active");
  backdrop.style.display = "none";
}

profileTrigger.addEventListener("click", togglePopup);
backdrop.addEventListener("click", closePopup);

window.addEventListener("beforeunload", () => {
  profilePopup.classList.remove("active");
});

// Optional Apple polish
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closePopup();
});
</script>

<script src="/static/script.js"></script>
<script>
function speak(text) {
  if (!window.speechSynthesis) return;

  const utter = new SpeechSynthesisUtterance(text);
  utter.rate = 1;
  utter.pitch = 1;
  utter.volume = 1;
  utter.lang = "en-US";

  speechSynthesis.cancel(); // stop previous
  speechSynthesis.speak(utter);
}
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/static/sw.js");
}
</script>
</body>
</html>